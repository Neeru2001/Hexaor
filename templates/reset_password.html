{% extends "auth_layout.html" %}

{% block title %}Reset Password{% endblock %}

{% block content %}
    <h2>Reset Your Password</h2>
    <form id="resetPasswordForm">
        <input type="hidden" name="token" value="{{ token }}">
        <div class="form-group">
            <label for="new_password">New Password</label>
            <input type="password" id="new_password" name="new_password" required>
        </div>
        <div class="form-group">
            <label for="confirm_password">Confirm New Password</label>
            <input type="password" id="confirm_password" name="confirm_password" required>
        </div>
        <button type="submit">Reset Password</button>
    </form>
    <div id="message"></div>
{% endblock %}

{% block scripts %}
<script>
    const resetPasswordForm = document.getElementById('resetPasswordForm');
    const messageDiv = document.getElementById('message');

    resetPasswordForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const token = e.target.token.value;
        const new_password = e.target.new_password.value;
        const confirm_password = e.target.confirm_password.value;

        if (new_password !== confirm_password) {
            showMessage('Passwords do not match.', false);
            return;
        }

        const response = await fetch('/reset_password/' + token, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ new_password })
        });
        const result = await response.json();

        showMessage(result.message, result.success);

        if (result.success) {
            setTimeout(() => {
                window.location.href = '{{ url_for("index") }}';
            }, 3000);
        }
    });

    function showMessage(message, isSuccess) {
        messageDiv.textContent = message;
        messageDiv.className = isSuccess ? 'success' : 'error';
        messageDiv.style.display = 'block';
    }
</script>
{% endblock %}
